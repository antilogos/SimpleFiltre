<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>TREE PARSER</title>
    <style>
    </style>
    <script>
    decodeBase64 = function(s) {
        var e={},i,b=0,c,x,l=0,a,r='',w=String.fromCharCode,L=s.length;
        var A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
        for(i=0;i<64;i++){e[A.charAt(i)]=i;}
        for(x=0;x<L;x++){
            c=e[s.charAt(x)];b=(b<<6)+c;l+=6;
            while(l>=8){((a=(b>>>(l-=8))&0xff)||(x<(L-2)))&&(r+=w(a));}
        }
        return r;
    };
    var skillTreeNodes = [];

      function parseSubmit() {
        var buffer = decodeBase64(document.getElementById("tree-input").value.split("/").pop().replace("-","+").replace("_","/"));
        //unpack("NVersion/cCharactersID/cAscendancyID/cIsLocked"if (arrayBuffer) {
        var reader = new Uint8Array(buffer.length);
        for(var i = 0; i < buffer.length; i++){
            reader[i] = buffer[i].charCodeAt(0);
        }
        // do something with each byte in the array
        var view = new DataView(reader.buffer, 0);

        // This is how the passive skill tree url is
        var version = view.getInt32(0);
        var characterClass = view.getInt8(4);
        var ascendancyClass = view.getInt8(5);
        var isFullscreen = view.getInt8(6);

        // List of passiveNodes are Int16 from offset 5
        var passiveNodes = [];
        for(var i = 7; i < buffer.length; i+=2){
          passiveNodes.push(view.getUint16(i));
        }

        skillTreeNodes = passiveNodes;
    }
    </script>
  </head>
    <body>
     <div id="maindiv" style="overflow: auto">
     </div>
     <input type="text" id="tree-input" size=80 required/>
     <input type="submit" id="tree-submit" size=15 onclick="parseSubmit()" />
    <h3>Contents of the file:</h3>
    <pre id="file-content"></pre>
  </body>
</html>
